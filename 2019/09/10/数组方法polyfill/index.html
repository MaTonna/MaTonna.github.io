<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 数组方法polyfill · MaTonna's blog</title><meta name="description" content="数组方法polyfill - MaTonna"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="github.com/MaTonna/atom.xml" title="MaTonna's blog"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">MaTonna's blog</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><ul class="shortcut-icons"><a href="https://github.com/MaTonna" target="_blank"><img src="/images/github.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">数组方法polyfill</h1><div class="post-info">Sep 10, 2019</div><div class="post-content"><h2>参考</h2>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array</a></p>
<h2>Array.prototype.forEach</h2>
<ol>
<li>描述：为数组中的每个元素执行一次回调函数。</li>
<li>特点：</li>
</ol>
<ul>
<li>不直接改变原数组</li>
<li>返回 undefined</li>
<li>不可链式调用</li>
<li>不可中止或跳出循环，除非抛出异常</li>
</ul>
<ol start="3">
<li>使用：</li>
</ol>
<p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// currentValue 正在处理的当前元素</span></span><br><span class="line"><span class="comment">// index 正在处理的当前元素的索引</span></span><br><span class="line"><span class="comment">// array 数组本身</span></span><br><span class="line"><span class="comment">// thisArg 执行回调函数用的this，可选</span></span><br><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">currentValue: <span class="built_in">any</span>, index: <span class="built_in">number</span>, array: []</span>): <span class="title">void</span></span>&#123;</span><br><span class="line">  <span class="comment">//...do something</span></span><br><span class="line">&#125;,thisArg:&#123;&#125;)</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>polyfill：</li>
</ol>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Array</span>.prototype.forEach) &#123;</span><br><span class="line">  <span class="built_in">Array</span>.prototype.forEach = <span class="function"><span class="keyword">function</span>(<span class="params">callback, thisArg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newThis;</span><br><span class="line">    <span class="keyword">var</span> index;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// this就是调用arr.forEach的arr</span></span><br><span class="line">    <span class="comment">// 校验arr，callback</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'this is null or not defined'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(callback + <span class="string">' is not a function'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      newThis = thisArg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> arr = <span class="built_in">Object</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &gt;&gt;&gt;为无符号移位，移位前将不是number类型的数据转换成number，将number转为无符号的Uint32类型</span></span><br><span class="line">    <span class="comment">// Unit32类型转换：不能转为number就为0，非整数先转为整数，如果是正数返回正数，负数返回负数+2^32</span></span><br><span class="line">    <span class="comment">// &gt;&gt;&gt;0保证len为数字类型且为正整数，缺省值为0</span></span><br><span class="line">    <span class="keyword">var</span> len = arr.length &gt;&gt;&gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环每个元素执行回调函数</span></span><br><span class="line">    <span class="keyword">while</span> (index &lt; len) &#123;</span><br><span class="line">      <span class="keyword">var</span> currentValue;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (index <span class="keyword">in</span> arr) &#123;</span><br><span class="line">        currentValue = arr[index];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// currentValue, index, arr是给回调函数的参数</span></span><br><span class="line">        callback.call(newThis, currentValue, index, arr);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>Array.prototype.map</h2>
<ol>
<li>描述：创建一个新数组，其结果是该数组中的每个元素都调用一个提供的函数后返回的结果。</li>
<li>特点：</li>
</ol>
<ul>
<li>不直接修改原数组</li>
<li>返回 callback 执行后的返回值组合的新数组</li>
<li>不可中止或跳出循环</li>
</ul>
<ol start="3">
<li>使用：</li>
</ol>
<p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> new_array = arr.map(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">currentValue[, index[, array]]</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// Return element for new_array</span></span><br><span class="line">&#125;[, thisArg])</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>polyfill：</li>
</ol>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Array</span>.prototype.map) &#123;</span><br><span class="line">  <span class="built_in">Array</span>.prototype.map = <span class="function"><span class="keyword">function</span>(<span class="params">callback, thisArg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newThis = thisArg || <span class="keyword">void</span> <span class="number">0</span>,</span><br><span class="line">      newArr,</span><br><span class="line">      index;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'this is null or not defined'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(callback) != <span class="string">'[object Function]'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(callback + <span class="string">' is not a function'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> arr = <span class="built_in">Object</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> len = arr.length &gt;&gt;&gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    newArr = <span class="keyword">new</span> <span class="built_in">Array</span>(len);</span><br><span class="line"></span><br><span class="line">    index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (index &lt; len) &#123;</span><br><span class="line">      <span class="keyword">var</span> currentValue, mappedValue;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (index <span class="keyword">in</span> arr) &#123;</span><br><span class="line">        currentValue = arr[index];</span><br><span class="line"></span><br><span class="line">        mappedValue = callback.call(newThis, currentValue, index, arr);</span><br><span class="line"></span><br><span class="line">        newArr[index] = mappedValue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newArr;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>Array.prototype.filter</h2>
<ol>
<li>描述：创建一个新数组, 其包含通过所提供函数实现的测试的所有元素。</li>
<li>特点：</li>
</ol>
<ul>
<li>返回执行 callback 后返回 true 或者等价于 true 的元素组成的新数组</li>
<li>不会直接改变原数组</li>
</ul>
<ol start="3">
<li>使用：</li>
</ol>
<p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> new_array = arr.filter(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">currentValue[, index[, array]]</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// Return element for new_array</span></span><br><span class="line">&#125;[, thisArg])</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>polyfill：</li>
</ol>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Array</span>.prototype.filter) &#123;</span><br><span class="line">  <span class="built_in">Array</span>.prototype.filter = <span class="function"><span class="keyword">function</span>(<span class="params">callback, thisArg</span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line">    <span class="keyword">if</span> (!((<span class="keyword">typeof</span> callback === <span class="string">'Function'</span> || <span class="keyword">typeof</span> callback === <span class="string">'function'</span>) &amp;&amp; <span class="keyword">this</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> len = <span class="keyword">this</span>.length &gt;&gt;&gt; <span class="number">0</span>,</span><br><span class="line">      newArr = <span class="keyword">new</span> <span class="built_in">Array</span>(len),</span><br><span class="line">      arr = <span class="keyword">this</span>,</span><br><span class="line">      c = <span class="number">0</span>, <span class="comment">// newArr的索引</span></span><br><span class="line">      i = <span class="number">-1</span>; <span class="comment">// arr的索引，从-1开始++i</span></span><br><span class="line">    <span class="keyword">if</span> (!thisArg) &#123;</span><br><span class="line">      <span class="comment">// 没有传入this，直接循环执行callback</span></span><br><span class="line">      <span class="keyword">while</span> (++i !== len) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">          <span class="comment">// 如果callback执行返回true，则将当前条赋值给newArr</span></span><br><span class="line">          <span class="keyword">if</span> (callback(arr[i], i, arr)) &#123;</span><br><span class="line">            newArr[c++] = arr[i];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (++i !== len) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (callback.call(thisArg, arr[i], i, arr)) &#123;</span><br><span class="line">            newArr[c++] = arr[i];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    newArr.length = c;</span><br><span class="line">    <span class="keyword">return</span> newArr;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>** 注：可中止循环的有：简单循环、for...of 循环、every()、some()、find()、findIndex()，数组的其他迭代方法 polyfill 可以根据以上方法的写法进行改造。 **</p>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'matonna';
var disqus_identifier = '2019/09/10/数组方法polyfill/';
var disqus_title = '数组方法polyfill';
var disqus_url = 'github.com/MaTonna/2019/09/10/数组方法polyfill/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//matonna.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2019/06/28/在vuepress中使用vue组件和highlight/" class="next">下一篇</a></div><div class="copyright"><p>© 2018 - 2019 <a href="github.com/MaTonna">MaTonna</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"matonna",'auto');ga('send','pageview');</script></body></html>